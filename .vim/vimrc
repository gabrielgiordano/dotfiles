" vim: fdm=marker
nnoremap <Space> za

" Vundle {{{1

set nocompatible
filetype off

" Set the runtime path to include Vundle and initialize
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()
" Alternatively, pass a path where Vundle should install plugins
" call vundle#begin('~/some/path/here')

" let Vundle manage Vundle, required
Plugin 'VundleVim/vundle.vim'

" Plugins {{{1

Plugin 'flazz/vim-colorschemes'
Plugin 'ctrlpvim/ctrlp.vim'
Plugin 'scrooloose/nerdtree'
Plugin 'airblade/vim-gitgutter'
Plugin 'bling/vim-airline'
Plugin 'vim-airline/vim-airline-themes'
Plugin 'thoughtbot/vim-rspec'
Plugin 'tpope/vim-cucumber'
Plugin 'godlygeek/tabular'
Plugin 'leafgarland/typescript-vim'
Plugin 'tpope/vim-endwise'

" Vundle {{{1

call vundle#end()
filetype plugin indent on

" UI {{{1

syntax enable
colorscheme Monokai

set number
set colorcolumn=80
set nowrap
set ruler
set showcmd
set noshowmode
set showmatch
set laststatus=2
set list listchars=tab:»·,trail:·

" Indentation {{{1

set autoindent
set tabstop=2
set softtabstop=2
set expandtab
set shiftwidth=2

" Searching {{{1

set hlsearch
set incsearch
set ignorecase
set smartcase

" Key Mappings {{{1

map Q gq

" Disable arrow keys
noremap <Up> <NOP>
noremap <Down> <NOP>
noremap <Left> <NOP>
noremap <Right> <NOP>

" CtrlP {{{1

let g:ctrlp_map = '<c-p>'
let g:ctrlp_cmd = 'CtrlP'
let g:ctrlp_working_path_mode = 'ra'
set wildignore+=*/.git/*

let g:ctrlp_open_func = { 'files': 'CustomOpenFunc' }
function! CustomOpenFunc(action, line)
  call call('ctrlp#acceptfile', [':t', a:line])
endfunction

" NERDTree {{{1

map <C-n> :NERDTreeToggle<CR>

" Vim Airline {{{1

let g:airline_theme='term'
" ThemePatch {{{2
let g:airline_theme_patch_func = 'AirlineThemePatch'
  function! AirlineThemePatch(palette)
    if g:airline_theme == 'term'
      let g:airline_left_sep=''
      let g:airline_right_sep=''
    endif
  endfunction
" 2}}}

" RSpec Vim {{{1

map tf :call RunCurrentSpecFile()<CR>
map te :call RunNearestSpec()<CR>
map tt :call RunLastSpec()<CR>
map tA :call RunAllSpecs()<CR>

" Other Settings {{{1

set history=5000
set lazyredraw
set encoding=utf-8
set backspace=indent,eol,start
set selection=exclusive
set clipboard=unnamedplus
set noswapfile

" Fast escape key
set timeoutlen=1000 ttimeoutlen=0

" tpope cucumber tables alignment gist {{{1

inoremap <silent> <Bar>   <Bar><Esc>:call <SID>align()<CR>a

function! s:align()
  let p = '^\s*|\s.*\s|\s*$'
  if exists(':Tabularize') && getline('.') =~# '^\s*|' && (getline(line('.')-1) =~# p || getline(line('.')+1) =~# p)
    let column = strlen(substitute(getline('.')[0:col('.')],'[^|]','','g'))
    let position = strlen(matchstr(getline('.')[0:col('.')],'.*|\s*\zs.*'))
    Tabularize/|/l1
    normal! 0
    call search(repeat('[^|]*|',column).'\s\{-\}'.repeat('.',position),'ce',line('.'))
  endif
endfunction
